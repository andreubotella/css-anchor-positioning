<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CSS Anchor Positioning Polyfill Demo</title>
    <link rel="stylesheet" href="https://unpkg.com/open-props" />
    <link rel="stylesheet" href="/demo.css" />
    <link rel="stylesheet" href="/anchor.css" />
    <link
      rel="stylesheet"
      data-style-anchor-positioning
      href="/anchor-positioning.css"
    />
    <link rel="stylesheet" href="/position-fallback.css" />
    <link rel="stylesheet" href="/anchor-scroll.css" />
    <link rel="stylesheet" href="/anchor-size.css" />
    <link rel="stylesheet" href="/anchor-math.css" />
    <style>
      #my-anchor-style-tag {
        anchor-name: --my-anchor-style-tag;
      }

      #my-target-style-tag {
        position: absolute;
        bottom: anchor(--my-anchor-style-tag start);
        right: anchor(--my-anchor-style-tag left);
      }
    </style>
    <script type="module">
      import polyfill from '/src/index-fn.ts';

      const btn = document.getElementById('apply-polyfill');

      if (!('anchorName' in document.documentElement.style)) {
        btn.addEventListener('click', () =>
          polyfill().then((rules) => {
            btn.innerText = 'Polyfill Applied';
            btn.setAttribute('disabled', '');
            console.log(rules);
          }),
        );
      } else {
        btn.innerText = 'No Polyfill Needed';
        btn.setAttribute('disabled', '');
        console.log(
          'anchor-positioning is supported in this browser; polyfill skipped.',
        );
      }
    </script>
  </head>
  <body>
    <header>
      <h1>CSS Anchor Positioning Polyfill</h1>
      <nav>
        <span> See also: </span>
        <a
          href="https://github.com/web-platform-tests/wpt/tree/master/css/css-anchor-position"
          target="_blank"
          rel="noopener noreferrer"
          >WPT examples</a
        >
        <a
          href="https://tabatkins.github.io/specs/css-anchor-position"
          target="_blank"
          rel="noopener noreferrer"
          >Draft Spec</a
        >
      </nav>
    </header>
    <div data-controls="apply-polyfill">
      <button id="apply-polyfill" data-button="apply-polyfill" type="button">
        Apply Polyfill
      </button>
    </div>

    <section id="anchor-positioning" class="demo-item">
      <h2>
        <a href="#anchor-positioning" aria-hidden="true">ðŸ”—</a> Anchor
        Positioning via anchor() [stylesheet]
      </h2>
      <div style="position: relative" class="demo-elements">
        <div id="my-target-positioning" class="target">Target</div>
        <div id="my-anchor-positioning" class="anchor">Anchor</div>
      </div>
      <pre>

/* demo.css */

#my-anchor-positioning {
  anchor-name: --my-anchor-positioning;
}

#my-target-positioning {
  position: absolute;
  right: anchor(--my-anchor-positioning right, 50px);
  top: anchor(--my-anchor-positioning bottom);
}
      </pre>
    </section>
    <section id="anchor-style-tag" class="demo-item">
      <h2>
        <a href="#anchor-style-tag" aria-hidden="true">ðŸ”—</a>
        Anchor Positioning via anchor() [&lt;style&gt; tag]
      </h2>
      <div style="position: relative" class="demo-elements">
        <div id="my-target-style-tag" class="target">Target</div>
        <div id="my-anchor-style-tag" class="anchor">Anchor</div>
      </div>
      <pre>

/* from the inside of a <code>style</code> tag */

#my-anchor-style-tag {
  anchor-name: --my-anchor-style-tag;
}

#my-target-style-tag {
  position: absolute;
  bottom: anchor(--my-anchor-style-tag start);
  right: anchor(--my-anchor-style-tag left);
}
      </pre>
    </section>
    <section id="anchor-inline" class="demo-item">
      <h2>
        <a href="#anchor-inline" aria-hidden="true">ðŸ”—</a>
        Anchor Positioning via anchor() [inline styles]
      </h2>
      <div style="position: relative" class="demo-elements">
        <div
          id="my-target-inline"
          class="target"
          style="
            position: absolute;
            top: anchor(--my-anchor-in-line bottom);
            right: anchor(--my-anchor-in-line right);
          "
        >
          Target
        </div>
        <div
          id="my-anchor-inline"
          class="anchor"
          style="anchor-name: --my-anchor-in-line"
        >
          Anchor
        </div>
      </div>
      <pre>

/* anchor */

  style="anchor-name: --my-anchor-in-line"

      
/* target */

  style="
    position: absolute;
    top: anchor(--my-anchor-in-line bottom);
    right: anchor(--my-anchor-in-line right);
  "

    </pre
      >
    </section>
    <section id="position-fallback" class="demo-item">
      <h2>
        <a href="#position-fallback" aria-hidden="true">ðŸ”—</a>
        Anchor Positioning via position-fallback
      </h2>
      <div style="position: relative" class="demo-elements">
        <div id="my-target-fallback" class="target">Target</div>
        <div id="my-anchor-fallback" class="anchor">Anchor</div>
      </div>
      <pre>

#my-anchor-fallback {
  anchor-name: --my-anchor-fallback;
}

#my-target-fallback {
  bottom: anchor(--my-anchor-fallback 25%);
  left: anchor(--my-anchor-fallback right);
  position: absolute;
  position-fallback: --fallback1;
}

@position-fallback --fallback1 {
  @try {
    /* 1: Position to the right of the anchor. */
    left: anchor(--my-anchor-fallback right, 10px);
    top: anchor(--my-anchor-fallback top);
}

  @try {
    /* 2: Position to the left of the anchor. */
    right: anchor(--my-anchor-fallback left);
    top: anchor(--my-anchor-fallback top);
}

  @try {
    /* 3: Position to the bottom of the anchor. */
    left: anchor(--my-anchor-fallback left);
    top: anchor(--my-anchor-fallback bottom);
}

  @try {
    /* 4: Position to the top of the anchor. */
    bottom: anchor(--my-anchor-fallback top);
    left: anchor(--my-anchor-fallback left);
}

  @try {
    /* 5: Position to the left with the narrower width. */
    height: 40px;
    left: anchor(--my-anchor-fallback right);
    top: anchor(--my-anchor-fallback top);
    width: 35px;
  }
}

      </pre>
    </section>
    <section id="anchor-scroll" class="demo-item">
      <h2>
        <a href="#anchor-scroll" aria-hidden="true">ðŸ”—</a>
        Anchor Positioning [with scroll]
      </h2>
      <div style="position: relative" class="demo-elements">
        <div id="scroll-container">
          <div id="scroll-contents">
            <div id="placefiller-above-anchor"></div>
            <div id="placefiller-before-anchor"></div>
            <span id="scroll-anchor" class="anchor">Anchor</span>
            <div id="inner-anchored" class="target">Inner-anchored Target</div>
          </div>
        </div>
        <div id="outer-anchored" class="target outer-anchored">
          Outer-anchored Target
        </div>
      </div>
    </section>
    <section id="custom-prop" class="demo-item">
      <h2>
        <a href="#custom-prop" aria-hidden="true">ðŸ”—</a>
        Anchor() [used in CSS custom property]
      </h2>
      <div style="position: relative" class="demo-elements">
        <div id="my-anchor" class="anchor">Anchor</div>
        <div id="my-target" class="target">Target</div>
      </div>
      <pre>

#my-anchor {
  anchor-name: --my-anchor;
}

#my-target {
  --center: anchor(--my-anchor 50%);
  --full: anchor(--my-anchor 100%);

  position: absolute;
  right: var(--full);
  top: var(--center);
}
      </pre>
    </section>
    <section id="math-function" class="demo-item">
      <h2>
        <a href="#math-function" aria-hidden="true">ðŸ”—</a>
        Anchor() [used in math function]
      </h2>
      <div style="position: relative" class="demo-elements">
        <div id="my-anchor-math" class="anchor">Anchor</div>
        <div id="my-target-math" class="target">Target</div>
      </div>
      <pre>
#my-anchor-math {
  . . .
}

#my-target-math {
  . . .
}
      </pre>
    </section>
    <section id="anchor-size" class="demo-item">
      <h2>
        <a href="#anchor-size" aria-hidden="true">ðŸ”—</a>
        Anchor Size
      </h2>
      <div id="my-anchor-size" class="anchor" class="demo-elements">Anchor</div>
      <div id="my-target-size" class="target">Target</div>
      <pre>
#my-anchor-size {
  . . .
}

#my-target-size {
  . . .
}
      </pre>
    </section>
    <footer>
      <p>
        Polyfill and demo by <a href="http://oddbird.net/">OddBird</a>. Designed
        using <a href="https://open-props.style/">Open Props</a>.
      </p>
    </footer>
  </body>
</html>
